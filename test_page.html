<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Tetikleme Testi</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
        }

        #status {
            margin-top: 20px;
            color: blue;
        }

        .warning {
            color: red;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h1>Extension Trigger Test</h1>

    <div class="warning">
        ÖNEMLİ: Bu sayfanın çalışması için <b>http://localhost</b> veya <b>http://127.0.0.1</b> üzerinden çalıştırılması
        gerekir (dosya sisteminden file:// çalışmayabilir).
    </div>

    <label for="extId">Extension ID:</label>
    <input type="text" id="extId" placeholder="Extension ID buraya yapıştırın" style="width: 300px;">
    <br><br>

    <button id="sendBtn">Extension'a "Hello" Mesajı Gönder</button>
    <br><br>

    <label for="customData">Mesaj:</label>
    <input type="text" id="customData" placeholder="Mesajınızı yazın..." style="width: 250px;">
    <button id="openSidePanelBtn">Panele Mesaj Gönder (Aç)</button>

    <br><br>
    <button id="closeSidePanelBtn" style="background-color: #fdd;">Paneli Gizle</button>

    <div id="status"></div>

    <script>
        // Hello butonuna gerek kalmadı ama kodda bozulma olmasın diye event listener'ı kaldırmıyoruz, HTML'den butonu sildik.

        document.getElementById('openSidePanelBtn').addEventListener('click', function () {
            const extensionId = document.getElementById('extId').value.trim();
            const data = document.getElementById('customData').value;
            const statusDiv = document.getElementById('status');

            if (!extensionId) {
                statusDiv.innerText = "Lütfen önce Extension ID giriniz.";
                statusDiv.style.color = "red";
                return;
            }

            statusDiv.innerText = "İstek gönderiliyor...";
            statusDiv.style.color = "blue";

            if (chrome && chrome.runtime && chrome.runtime.sendMessage) {
                chrome.runtime.sendMessage(extensionId, { action: "open_popup_with_data", text: data },
                    function (response) {
                        if (chrome.runtime.lastError) {
                            console.error(chrome.runtime.lastError);
                            statusDiv.innerText = "Hata: " + chrome.runtime.lastError.message;
                            statusDiv.style.color = "red";
                        } else {
                            console.log("Yanıt:", response);
                            statusDiv.innerText = "Başarılı! Extension yanıtı: " + JSON.stringify(response);
                            statusDiv.style.color = "green";
                        }
                    }
                );
            } else {
                statusDiv.innerText = "chrome.runtime API bulunamadı. Chrome tarayıcısında mısınız?";
                statusDiv.style.color = "red";
            }
        });

        document.getElementById('closeSidePanelBtn').addEventListener('click', function () {
            const extensionId = document.getElementById('extId').value.trim();
            if (!extensionId) return;

            if (chrome && chrome.runtime && chrome.runtime.sendMessage) {
                chrome.runtime.sendMessage(extensionId, { action: "close_side_panel" }, function (response) {
                    console.log("Kapatma yanıtı:", response);
                });
            }
        });
    </script>
</body>

</html>